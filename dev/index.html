<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ModelingToolkitInputs.jl</title><meta name="title" content="Home · ModelingToolkitInputs.jl"/><meta property="og:title" content="Home · ModelingToolkitInputs.jl"/><meta property="twitter:title" content="Home · ModelingToolkitInputs.jl"/><meta name="description" content="Documentation for ModelingToolkitInputs.jl."/><meta property="og:description" content="Documentation for ModelingToolkitInputs.jl."/><meta property="twitter:description" content="Documentation for ModelingToolkitInputs.jl."/><meta property="og:url" content="https://bradcarman.github.io/ModelingToolkitInputs.jl/"/><meta property="twitter:url" content="https://bradcarman.github.io/ModelingToolkitInputs.jl/"/><link rel="canonical" href="https://bradcarman.github.io/ModelingToolkitInputs.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ModelingToolkitInputs.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#Indeterminate-Form:-Using-ModelingToolkit-with-Streaming-Data"><span>Indeterminate Form: Using ModelingToolkit with Streaming Data</span></a></li><li><a class="tocitem" href="#Determinate-Form:-Connecting-ModelingToolkit-inputs-to-Data"><span>Determinate Form: Connecting ModelingToolkit <code>inputs</code> to Data</span></a></li><li><a class="tocitem" href="#Benefits-of-ModelingToolkitInputs-vs.-DataInterpolations"><span>Benefits of ModelingToolkitInputs vs. DataInterpolations</span></a></li><li><a class="tocitem" href="#Discontinuities"><span>Discontinuities</span></a></li><li class="toplevel"><a class="tocitem" href="#API"><span>API</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bradcarman/ModelingToolkitInputs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bradcarman/ModelingToolkitInputs.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ModelingToolkitInputs.jl"><a class="docs-heading-anchor" href="#ModelingToolkitInputs.jl">ModelingToolkitInputs.jl</a><a id="ModelingToolkitInputs.jl-1"></a><a class="docs-heading-anchor-permalink" href="#ModelingToolkitInputs.jl" title="Permalink"></a></h1><p>ModelingToolkitInputs.jl provides support for driving <code>ModelingToolkit</code> model inputs with data in determinate (data known upfront) and indeterminate form (data streamed at runtime).</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Pkg
Pkg.add(&quot;ModelingToolkitInputs&quot;)</code></pre><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><p>In <code>ModelingToolkit</code> it is possible to mark a variable as an input, as follows</p><pre><code class="language-julia hljs">@variables x(t) [input=true]</code></pre><p>When compiling the model using <a href="https://docs.sciml.ai/ModelingToolkit/stable/API/model_building/#ModelingToolkit.mtkcompile"><code>mtkcompile</code></a>, if the input variable is not connected to a source, then it must be specified with the <code>inputs</code> keyword.  When this is done, <code>ModelingToolkit</code> will convert the variable to a &quot;discrete variable&quot;.  In <code>ModelingToolkit</code> a discrete variable is technically a parameter that has an independant variable.  So for example one can create a discrete variable as follows</p><pre><code class="language-julia hljs">@parameters x(t)</code></pre><p>In <code>ModelingToolkitInputs</code> a new system type <code>InputSystem</code> is provided that adds the functions necessary (<code>input_functions</code>) to feed data into these discrete input variables. The <code>input_functions</code> are generated when calling <code>mtkcompile</code> on an <code>InputSystem</code>, as follows.</p><pre><code class="language-julia hljs">using ModelingToolkit
using ModelingToolkit: t_nounits as t, D_nounits as D
using ModelingToolkitInputs

# Define system with an input variable
@variables x(t) [input=true]
@variables y(t) = 0

eqs = [D(y) ~ x]

# Compile with inputs specified
@mtkcompile sys=InputSystem(eqs, t, [x, y], []) inputs=[x]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">InputSystem
<span class="sgr1">Model sys:</span>
<span class="sgr1">Equations (1):</span>
  1 standard: see equations(sys)
<span class="sgr1">Unknowns (1):</span> see unknowns(sys)
  y(t) [defaults to 0]
<span class="sgr1">Parameters (1):</span> see parameters(sys)
  x(t) [defaults to 0.0]</code></pre><p>As can be seen this system has 2 variables and 1 equation. By telling <code>ModelingToolkit</code> that <code>x</code> is an input, the system is then balanced because a connection with <code>x</code> is now assumed.  The <code>input_functions</code> which are generated enable that assumed connection to a data source.  </p><p>Note: when the <code>System</code> is defined in a function, it can be converted to an <code>InputSystem</code> as follows.</p><pre><code class="language-julia hljs">function Demo(;name)
    @variables x(t) [input=true]
    @variables y(t) = 0

    eqs = [D(y) ~ x]

    return System(eqs, t, [x, y], []; name)
end

@named demo = Demo()
@mtkcompile sys=InputSystem(demo) inputs=ModelingToolkit.unbound_inputs(demo)</code></pre><h2 id="Indeterminate-Form:-Using-ModelingToolkit-with-Streaming-Data"><a class="docs-heading-anchor" href="#Indeterminate-Form:-Using-ModelingToolkit-with-Streaming-Data">Indeterminate Form: Using ModelingToolkit with Streaming Data</a><a id="Indeterminate-Form:-Using-ModelingToolkit-with-Streaming-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Indeterminate-Form:-Using-ModelingToolkit-with-Streaming-Data" title="Permalink"></a></h2><p>When input values need to be computed on-the-fly or depend on external data sources, you can manually set inputs while steping the integrator using <code>set_input!</code>.  </p><pre><code class="language-julia hljs">using OrdinaryDiffEq
using Plots

prob = ODEProblem(sys, [], (0, 4))

# Initialize the integrator
integrator = init(prob, Tsit5())

# Manually set inputs and step through time
dt = 1.0
for i=1:4
    # input streaming data
    set_input!(integrator, sys.x, i)

    # step the model forward in time
    step!(integrator, dt, true)

    # (optional) compute something with outputs...
    println(&quot;y=$(integrator[y])&quot;)
end

finalize!(integrator)

plot(integrator.sol; idxs = [x, y])</code></pre><img src="index-4ea316f6.svg" alt="Example block output"/><p>Note: here we can see that <code>x</code> initializes at a value of 0.0, which is the assumed initial value if no default value is given in the model.  As can be seen, this is no concequence as the value changes immediately at time 0 to the set value of 1.0 before steping the integrator.</p><div class="admonition is-warning" id="Always-call-finalize!-9dc5bbef4562ecb7"><header class="admonition-header">Always call `finalize!`<a class="admonition-anchor" href="#Always-call-finalize!-9dc5bbef4562ecb7" title="Permalink"></a></header><div class="admonition-body"><p>When using <code>set_input!</code>, you must call <code>finalize!</code> after integration is complete. This ensures that all discrete callbacks associated with input variables are properly saved in the solution. Without this call, input values may not be correctly recorded when querying the solution.</p></div></div><h2 id="Determinate-Form:-Connecting-ModelingToolkit-inputs-to-Data"><a class="docs-heading-anchor" href="#Determinate-Form:-Connecting-ModelingToolkit-inputs-to-Data">Determinate Form: Connecting ModelingToolkit <code>inputs</code> to Data</a><a id="Determinate-Form:-Connecting-ModelingToolkit-inputs-to-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Determinate-Form:-Connecting-ModelingToolkit-inputs-to-Data" title="Permalink"></a></h2><p>When data is available, you can use the <code>Input</code> type to specify input values at specific time points. The solver will automatically apply these values using discrete callbacks.  Then supply a vector of <code>Input</code>&#39;s using the <code>inputs</code> keyword to <code>solve</code>.</p><pre><code class="language-julia hljs"># Create an Input object with predetermined values
input = Input(sys.x, [1, 2, 3, 4], [0, 1, 2, 3])

sol = solve(prob, Tsit5(); inputs=[input])

plot(sol; idxs = [x, y])</code></pre><img src="index-1c4845b8.svg" alt="Example block output"/><p>Multiple <code>Input</code> objects can be passed in a vector to handle multiple input variables simultaneously.</p><h2 id="Benefits-of-ModelingToolkitInputs-vs.-DataInterpolations"><a class="docs-heading-anchor" href="#Benefits-of-ModelingToolkitInputs-vs.-DataInterpolations">Benefits of ModelingToolkitInputs vs. DataInterpolations</a><a id="Benefits-of-ModelingToolkitInputs-vs.-DataInterpolations-1"></a><a class="docs-heading-anchor-permalink" href="#Benefits-of-ModelingToolkitInputs-vs.-DataInterpolations" title="Permalink"></a></h2><p>There are several reasons why one would want to input data into their model using <code>ModelingToolkitInputs</code>:</p><ol><li>The same <code>System</code> (or <code>InputSystem</code>) can be used in both determinate and indeterminate forms without requiring any changes or modifications to the system.  This makes it very convenient to use and test the system against previously recorded data and be sure the exact same system will work in practice/deployment with streaming data.</li><li>Running several large datasets using <code>ModelingToolkitInputs</code> requires only 1 step: (1) call <code>solve</code> with each dataset.  When the data is included in the system using an interpolation object, this requires 2 steps: (1) <code>remake</code> the problem with new data, (2) then call solve.  </li><li>The 2 step process described above is significantly slower than the single step solve with <code>ModelingToolkitInputs</code></li><li>Finally using Interpolation requires that the data length be a constant for all datasets.</li></ol><p>The following example demonstrates this comparison.</p><pre><code class="language-julia hljs">using ModelingToolkit
using ModelingToolkit: t_nounits as t, D_nounits as D
using ModelingToolkitInputs
using ModelingToolkitStandardLibrary.Blocks
using DataInterpolations
using OrdinaryDiffEq
using Plots

function MassSpringDamper(; name)
    vars = @variables begin
        f(t), [input = true]
        x(t)=0
        dx(t)=0
        ddx(t)
    end
    pars = @parameters m=10 k=1000 d=1

    eqs = [ddx * 10 ~ k * x + d * dx + f
           D(x) ~ dx
           D(dx) ~ ddx
           ]

    return System(eqs, t, vars, pars; name)
end

function MassSpringDamperSystem(data, time; name)
    @named src = ParametrizedInterpolation(ConstantInterpolation, data, time)
    @named clk = ContinuousClock()
    @named model = MassSpringDamper()

    eqs = [model.f ~ src.output.u
           connect(clk.output, src.input)]

    return System(eqs, t; name, systems = [src, clk, model])
end

dt = 4e-4
time = collect(0:dt:0.1)
data = 2 .* sin.(2 * pi * time * 100)

@mtkcompile sys = MassSpringDamperSystem(data, time)
prob = ODEProblem(sys, [], (0, time[end]))
sol1 = solve(prob)
plot(sol1; idxs=sys.model.dx)</code></pre><img src="index-e7df148c.svg" alt="Example block output"/><p>Now let&#39;s record how much time it takes to replace the data.</p><pre><code class="language-julia hljs">using BenchmarkTools
data2 = 100 .* one.(data)
sol2 = @btime begin
    prob2 = remake(prob, p = [sys.src.data =&gt; data2])
    solve(prob2)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  403.437 ms (2338226 allocations: 70.68 MiB)</code></pre><p>As can be seen, this takes over 400ms to run a new dataset.  In comparison using <code>ModelingToolkitInputs</code> only takes just over 1ms for each dataset run.  Additionally note, we can run the <code>MassSpringDamper</code> component directly without needing to wrap it in another component, making it very simple to run in determiniate or indeterminate forms.  </p><pre><code class="language-julia hljs">@named sysi = MassSpringDamper()
inputs=ModelingToolkit.unbound_inputs(sysi); #f
sysi = mtkcompile(InputSystem(sysi); inputs)
probi = ODEProblem(sysi, [], (0, time[end]))

sol1i = @btime begin
    in1 = Input(sysi.f, data, time)
    solve(probi; inputs=[in1])
end
sol2i = @btime begin
    in2 = Input(sysi.f, data2, time)
    solve(probi; inputs=[in2])
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  1.753 ms (21442 allocations: 3.93 MiB)
  1.751 ms (21442 allocations: 3.93 MiB)</code></pre><h2 id="Discontinuities"><a class="docs-heading-anchor" href="#Discontinuities">Discontinuities</a><a id="Discontinuities-1"></a><a class="docs-heading-anchor-permalink" href="#Discontinuities" title="Permalink"></a></h2><p>One important detail to point out is that the input is discontinuous.  Note that the interpolation type set is <code>ConstantInterpolation</code> to provide the true form of the data input.  In order to properly numerically solve this, the solver needs to know when these discontinuites occur.  Currently this is not automatically provided by <code>ModelingToolkit</code> interpolation, and it hasn&#39;t been added manually in this comparison.  As a result the <code>DataInterpolations</code> solution is done in 122 steps.  The use of <code>ModelingToolkitInputs</code> however does provide the correct solving for discontinuities becuase the use of <code>DiscreteCallbacks</code> is used at each discrete data input time.  Therefore the solution is given in <code>n=2*length(time)</code> because a solve is done on each side of the discrete steps.  The difference in solution quality can be seen when comparing <code>sol1</code> and <code>sol1i</code> where the input force is a sine wave.  </p><pre><code class="language-julia hljs">plot(sol1.t, sol1[sys.model.dx]; marker=:dot, label=&quot;MTK + Interpolation (n=$(length(sol1.t)))&quot;)
plot!(sol1i.t, sol1i[sysi.dx]; marker=:+, label=&quot;ModelingToolkitInputs (n=$(length(sol1i.t)))&quot;)</code></pre><img src="index-d38de2f7.svg" alt="Example block output"/><p>Therefore the end result is <code>ModelingToolkitInputs</code> offers a faster, more convenient way to provide data input with a higher accuracy solution provided automatically.  </p><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkitInputs.Input" href="#ModelingToolkitInputs.Input"><code>ModelingToolkitInputs.Input</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Input(var, data, time)</code></pre><p>Type used to provide data input for a <code>InputSystem</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bradcarman/ModelingToolkitInputs.jl/blob/b554751c3510b77852dd470953f67536fcbd0e50/src/ModelingToolkitInputs.jl#L72-L76">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkitInputs.InputSystem" href="#ModelingToolkitInputs.InputSystem"><code>ModelingToolkitInputs.InputSystem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">InputSystem(sys::ModelingToolkit.System)
InputSystem(eqs, args...; kwargs...)</code></pre><p>Wraps a <code>ModelingToolkit.System</code> object to provide the functions to feed data to discrete variables.  Generate an <code>InputSystem</code> either directly in place of a <code>System</code> or by wrapping an already generate system.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bradcarman/ModelingToolkitInputs.jl/blob/b554751c3510b77852dd470953f67536fcbd0e50/src/ModelingToolkitInputs.jl#L17-L22">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkitInputs.set_input!" href="#ModelingToolkitInputs.set_input!"><code>ModelingToolkitInputs.set_input!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_input!(input_integrator::InputIntegrator, var, value::Real)</code></pre><p>Sets the value of a discrete variable of a <code>ModelingToolkit</code> input.  For example</p><pre><code class="language-julia hljs">set_input!(integrator, sys.x, 1.0)
step!(integrator, dt)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bradcarman/ModelingToolkitInputs.jl/blob/b554751c3510b77852dd470953f67536fcbd0e50/src/ModelingToolkitInputs.jl#L121-L130">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ModelingToolkitInputs.finalize!" href="#ModelingToolkitInputs.finalize!"><code>ModelingToolkitInputs.finalize!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">finalize!(input_integrator::InputIntegrator)</code></pre><p>Saves the final state of all discrete variables.  Call after the final step of the integrator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bradcarman/ModelingToolkitInputs.jl/blob/b554751c3510b77852dd470953f67536fcbd0e50/src/ModelingToolkitInputs.jl#L143-L147">source</a></section></article><p>In addition, the keyword <code>inputs</code> is added to <code>solve</code>.  </p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Monday 3 November 2025 14:18">Monday 3 November 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
